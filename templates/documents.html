{% extends "base.html" %}

{% block title %}Данные - Анализ данных{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Просмотр данных из базы</h1>
        </div>
    </div>
</div>

{% if years_data %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Данные по годам</h5>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs" id="yearsTabs" role="tablist">
                    {% for year_data in years_data %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link {% if loop.first %}active{% endif %}"
                                    id="year-{{ year_data.year }}-tab"
                                    data-bs-toggle="tab"
                                    data-bs-target="#year-{{ year_data.year }}"
                                    type="button"
                                    role="tab"
                                    aria-controls="year-{{ year_data.year }}"
                                    aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                {{ year_data.year }}
                            </button>
                        </li>
                    {% endfor %}
                </ul>

                <div class="tab-content mt-3" id="yearsTabsContent">
                    {% for year_data in years_data %}
                        <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
                             id="year-{{ year_data.year }}"
                             role="tabpanel"
                             aria-labelledby="year-{{ year_data.year }}-tab">

                            <h4 class="mb-3">Год: {{ year_data.year }}</h4>

                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-bordered table-sm">
                                    <thead class="table-primary">
                                        <tr>
                                            <th class="text-center align-middle" style="min-width: 200px;">Признак</th>
                                            {% for district_name in year_data.district_names %}
                                                <th class="text-center align-middle">{{ district_name }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for feature in year_data.features %}
                                            <tr>
                                                <td class="fw-bold">{{ feature.name }}</td>
                                                {% for value in feature.district_values %}
                                                    <td class="text-end">
                                                        {% if value is not none %}
                                                            {{ "%.2f"|format(value) }}
                                                        {% else %}
                                                            <span class="text-muted">—</span>
                                                        {% endif %}
                                                    </td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="mt-3 text-muted">
                                <small>
                                    Признаков: <strong>{{ year_data.features|length }}</strong> |
                                    Районов: <strong>{{ year_data.district_names|length }}</strong>
                                </small>
                            </div>

                        </div>
                    {% endfor %}
                </div>

                <div class="mt-3 text-muted">
                    Всего годов: <strong>{{ years_data|length }}</strong>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="alert alert-info">
    В базе данных пока нет данных. Загрузите данные из Excel файла на главной странице.
</div>
{% endif %}

{% endblock %}
